<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>
<body class="container">
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"
    type="application/javascript"></script>
     
    <script>
         
         window.onload=function(){


           
            getVotes();

         }
        function getVotes(){

           

         abi=[
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			}
		],
		"name": "delegate",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "voter",
				"type": "address"
			}
		],
		"name": "giveRightToVote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "proposal",
				"type": "uint256"
			}
		],
		"name": "vote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "chairperson",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "proposals",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "voteCount",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "voters",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "weight",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "voted",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "delegate",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "vote",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "winnername",
		"outputs": [
			{
				"internalType": "string",
				"name": "winnername_",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "winningProposal",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "winningProposal_",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
            
            // const provider=new ethers.providers.Web3Provider(web3.currentProvider);
            const provider = new ethers.providers.Web3Provider(window.ethereum)
            
            contract=new ethers.Contract("0x756A39a57b16B019eb8aD701e8727f7A91B87fBB",abi,provider);
           
            var proposal0=contract.proposals(0);
            proposal0.then(function (result) {
                // document.getElementById("metamask").innerHTML="results";
                document.getElementById("proposal0name").innerHTML=result[0];
                document.getElementById("vote0count").innerHTML=result[1];
            });

            var proposal1=contract.proposals(1);
            proposal1.then(function (result) {
                // document.getElementById("metamask").innerHTML="results";
                document.getElementById("proposal1name").innerHTML=result[0];
                document.getElementById("vote1count").innerHTML=result[1];
            });

            var proposal2=contract.proposals(2);
            proposal2.then(function (result) {
                // document.getElementById("metamask").innerHTML="results";
                document.getElementById("proposal2name").innerHTML=result[0];
                document.getElementById("vote2count").innerHTML=result[1];
            });

            
          
     
         }

         function vote()
         {
            abi=[
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			}
		],
		"name": "delegate",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "voter",
				"type": "address"
			}
		],
		"name": "giveRightToVote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "proposal",
				"type": "uint256"
			}
		],
		"name": "vote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "chairperson",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "proposals",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "voteCount",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "voters",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "weight",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "voted",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "delegate",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "vote",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "winnername",
		"outputs": [
			{
				"internalType": "string",
				"name": "winnername_",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "winningProposal",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "winningProposal_",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
            const provider = new ethers.providers.Web3Provider(window.ethereum)

            provider.send('eth_requestAccounts', []);
            
            signer=provider.getSigner(0);
            contract=new ethers.Contract("0x756A39a57b16B019eb8aD701e8727f7A91B87fBB",abi,signer);

            var proposalval=document.getElementById("ProposalSelect").value;
            var castvote=contract.vote(proposalval);
            castvote.then(function (transaction){
                document.getElementById("metamask").innerHTML=transaction
            })
            


         }

         function delegate()
         {
            abi=[
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			}
		],
		"name": "delegate",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "voter",
				"type": "address"
			}
		],
		"name": "giveRightToVote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "proposal",
				"type": "uint256"
			}
		],
		"name": "vote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "chairperson",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "proposals",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "voteCount",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "voters",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "weight",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "voted",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "delegate",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "vote",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "winnername",
		"outputs": [
			{
				"internalType": "string",
				"name": "winnername_",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "winningProposal",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "winningProposal_",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
            const provider = new ethers.providers.Web3Provider(window.ethereum)

            provider.send('eth_requestAccounts', []);
            
            signer=provider.getSigner(0);
            contract=new ethers.Contract("0x756A39a57b16B019eb8aD701e8727f7A91B87fBB",abi,signer);

            var addressval=document.getElementById("txtaddress").value;
            var delegatevote=contract.delegate(addressval);
            delegatevote.then(function (transaction){
                document.getElementById("metamask").innerHTML=transaction
            })
            


         }

         

        

         

         


    </script>

<div id="metamask"></div>

    <h1>Voting dApp in Solidity and Ethers.js</h1>

    <div class="table-responsive">


        <table class="table table-bordered">

            <thead>
                <tr>
                    <th>Candidate</th>
                    <th>Votes</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="proposal0name">
       
                    </td>
                    <td id="vote0count">
                            
                    </td>

                </tr>

                <tr>
                    <td id="proposal1name"></td>
                    <td id="vote1count"></td>
                </tr>

                <tr>
                    <td id="proposal2name"></td>
                    <td id="vote2count"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <select id="ProposalSelect">
        <option value="-1">Select the proposal to vote</option>
        <option value="0">Oranges</option>
        <option value="1">Apples</option>
        <option value="2">Mangoes</option>
    </select>

    <input id="Button1" type="button" onclick="vote()" class="btn btn-info" value="Vote" />

    or Delegate Someone to Vote

    <input id="txtaddress" type="text" />
    <input id="Button1" type="button" onclick="delegate()" class="btn btn-info" value="Delegate" />
    
</body>
</html>